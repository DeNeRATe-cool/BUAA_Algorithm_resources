# J Regulus

* 给定仅包含小写字母或 `?` 的字符串 $s,t$ ，其中 `?` 代表通配符，求 $t$ 能与所有 $s$ 子串匹配的位置
* 首先考虑没有通配符的情况对于两个字符串 $s,t(|s|\ge|t|)$ ，令 $n=|s|,m=|t|$ ，我们考察 $t$ 与 $s[x,x+m-1]$，定义函数 $P(x)=\Sigma_{i=1}^{m}(s_{i+x}-t_{i})^2,1\le x\le n-m+1$ 
* 则匹配成功当且仅当 $P(x)=0$ 
* $P(x)=\Sigma_{i=1}^m(s_{i+x}^2+t_i^2-2\times s_{i+x}t_i)$ 前两部分都可以 $O(1)$ 地计算，我们考虑如何计算最后一部分
* 我们将 $t$ 转置，则 $P(k)=\Sigma_{i=1}^m(s_{i+k}^2+t_i^2-2\times s_{i+k}t_{m-i+1})$ 观察最后一部分的下标和恰好为 $k+m+1$ ，为一个卷积地形式，故可以用FFT来计算该式子值，为 $0(\le 0.5)$ 即可认为匹配成功
* 具体地，令 $s_i$ 表示 $f(x)$ 中 $x^i$ 项的系数， $t_i$ 表示 $g(x)$ 中 $x_i$ 项的系数，则 $P$ 中最后一项即为 $f(x)\times g(x)$ 中 $x^{k+m+1}$ 项的系数
* 再考虑有通配符的情况，我们只需要改写 $P(x)$ 的定义即可，我们令通配符为 $0$ ，令 $P(x)=\Sigma_{i=1}^m(s_{i+x}-t_i)^2s_{i+x}t_i=\Sigma_{i=1}^m(s_{i+x}^3t_i+s_{i+x}t_i^3-2s_{i+x}^2t_i^2)$ ，类似地做三遍FFT即可
* 时间复杂度 $O(n\log n)$ ，但常数较大
* 需要注意多测
